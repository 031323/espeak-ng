#!/bin/sh

# Test a command for presence and ability to output the sha1 hash of a file.
check_hashcmd() {
	which $1 &>/dev/null &&
	$1 </dev/null 2>/dev/null |
	awk '{if ($1 != "da39a3ee5e6b4b0d3255bfef95601890afd80709") { exit 1; }}'
}

# Test some common commands to find the correct one for the system being tested on.
if check_hashcmd sha1sum; then
	sha1sum=sha1sum
elif check_hashcmd sha1; then
	sha1sum=sha1
elif check_hashcmd shasum; then
	sha1sum=shasum
else
	echo "No hashing commands found."
	exit 1
fi

test_lang() {
	TEST_LANG=$1
	EXPECTED=$2
	TEST_TEXT=$3

	echo "testing ${TEST_LANG}"
	ESPEAK_DATA_PATH=`pwd` LD_LIBRARY_PATH=src:${LD_LIBRARY_PATH} \
		src/espeak-ng --stdout -v ${TEST_LANG} "[[${TEST_TEXT}]]" | \
		$sha1sum | awk '{ print $1 }' > actual.txt
	echo "${EXPECTED}" > expected.txt
	diff expected.txt actual.txt || exit 1
}

test_lang af c71ab424d045d9fa82d2a23b9be4542aee3ed15e "ma na Na pa ta ka tSa ba da ga dZa fa sa x2a Sa va za Za ca la ja ra r/a _:_ m@ ma mE mI mO mW mu m& m&: m@L mA: me@ mi mo@ my miu m@U maI mAI meI mOI moI muI mYy mY@ maU me: mO: m3: mA~ me~ mo~"
test_lang am 4fcdb9bb68b72c06e4cadf91b2c1e244ea14ac21 "ma na Na pa ta ka ?a ba da ga p\`a t\`a k\`a tSa dZa tS\`a Ba sa za Sa Za xa ha la ja wa ra _:_ mi me my ma m@ mo mu"
test_lang an 33304ad847d920652c74e1c51d12bbe6de9a182d "ma na Na pa ta tSa ka ba da ga fa Ta sa Sa ja wa la l^a ra Ra _:_ ma ma/ me me/ mi mo mo/ mu"
test_lang ar a67110f62981c0668bdbeb44feec7b3268a38353 "ma na pa ta ka qa ?a ba da dHa fa va Ta Da s[a sa za Sa Za xa Xa gHa Ha Aa dZa ra la l/2a ja wa _:_ ma mi mu ma: mi: mu: maw maj"
test_lang as 05d4cca91fc3447ae8b6acd7892790dd364e8e23 "ma na Na pa ta ka p#a t#a k#a ba da ga b#a d#a g#a sa xa Xa ha tSa tS#a za wa ra ja la _:_ ma mi mu me m& mo mO mV ma~ mi~ mu~ me~ m&~ mo~ mO~ moj mo~j mow mo~w mew maV m@"
test_lang az 7bdb78c37433a47fb3b15808071b1a916202400c "ma na pa ba ta da tSa dZa tsa dza ca Ja Ca ka ga fa va sa za Sa Za xa Qa ha la ja wa Ra *a _:_ mi me m& my mW mu mo ma m@"
test_lang bg 3020acb23ac0f93d5479de3b305b71fc07b5e738 "ma na n^a Na m;a pa ba ta da ka ga p;a b;a t;a d;a ca Ja tsa dza tSa dZa ts;a dz;a fa va sa za Sa Za xa Qa f;a v;a s;a z;a x;a Ra R;a wa ja l/2a la l^a _:_ mi me m@ ma mo mu"
